<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Éditer les valeurs</title>
</head>
<body>
    <h1>Éditer les valeurs des équipes</h1>
    <p>Collez les données Excel ici (Nom, Bureau, Date, Statut, Durée) :</p>
    <textarea id="excelData" rows="10" cols="50" placeholder="Collez ici les données copiées depuis Excel..."></textarea><br><br>

    <button type="button" onclick="processData()">Calculer les weeks par équipe</button>
    <button type="button" onclick="saveValues()">Sauvegarder</button>
    <button type="button" onclick="returnToMainPage()">Retourner à la page principale</button>

    <h2>Résultats par équipe</h2>
    <ul>
        <li>Équipe Rouge : <span id="totalWeeksRed">0</span> weeks</li>
        <li>Équipe Vert : <span id="totalWeeksGreen">0</span> weeks</li>
        <li>Équipe Violet : <span id="totalWeeksPurple">0</span> weeks</li>
    </ul>

    <script>
        // Définition des équipes et de leurs membres
        const teamAssignments = {
            "Équipe Rouge": ["Adlene Chanegriha", "Margot Guillard"],
            "Équipe Vert": ["Alexa Coutant", "Maxime Bienne"],
            "Équipe Violet": ["Elisa Lombe", "Lisa Deroy"]
        };

        function processData() {
            const excelText = document.getElementById("excelData").value;
            const rows = excelText.trim().split("\n");
            const personWeeks = {};

            // Parcours de chaque ligne pour calculer les weeks par personne
            rows.forEach(row => {
                const columns = row.split("\t"); // Diviser par tabulation
                const fullName = columns[0].trim(); // Colonne "Opportunity Owner: Full Name"
                const weeks = parseInt(columns[4].trim()); // Colonne "Duration"

                if (!isNaN(weeks)) {
                    if (personWeeks[fullName]) {
                        personWeeks[fullName] += weeks;
                    } else {
                        personWeeks[fullName] = weeks;
                    }
                }
            });

            // Calcul des weeks par équipe
            const teamTotals = {
                "Équipe Rouge": 0,
                "Équipe Vert": 0,
                "Équipe Violet": 0
            };

            for (const person in personWeeks) {
                for (const team in teamAssignments) {
                    if (teamAssignments[team].includes(person)) {
                        teamTotals[team] += personWeeks[person];
                        break;
                    }
                }
            }

            // Mise à jour des résultats par équipe dans le HTML
            document.getElementById("totalWeeksRed").textContent = teamTotals["Équipe Rouge"];
            document.getElementById("totalWeeksGreen").textContent = teamTotals["Équipe Vert"];
            document.getElementById("totalWeeksPurple").textContent = teamTotals["Équipe Violet"];
        }

        function saveValues() {
            // Sauvegarde des résultats dans le localStorage pour la page principale
            localStorage.setItem("weeksRed", document.getElementById("totalWeeksRed").textContent);
            localStorage.setItem("weeksGreen", document.getElementById("totalWeeksGreen").textContent);
            localStorage.setItem("weeksPurple", document.getElementById("totalWeeksPurple").textContent);

            alert("Valeurs sauvegardées !");
        }

        function returnToMainPage() {
            saveValues();
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
